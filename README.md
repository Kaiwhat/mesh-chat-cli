# mesh-chat-cli

> ä¸€å¥—ç”¨æ–¼ Raspberry Pi çš„å‘½ä»¤åˆ— Mesh èŠå¤©å·¥å…·ï¼ŒåŸºæ–¼ `batman-adv` èˆ‡ IBSS ç„¡ç·šæ¨¡å¼ï¼Œå¯æ–¼ç„¡ç¶²éš›ç¶²è·¯ç’°å¢ƒä¸­å¯¦ç¾å³æ™‚å¤šäººèŠå¤©èˆ‡ç§äººè¨Šæ¯ã€‚

---

## ç³»çµ±éœ€æ±‚

- Raspberry Pi
- Raspberry Pi OS
- Python 3.7+
- Dependencyï¼š
  - `wcwidth`ï¼ˆä¸­è‹±æ–‡æ··æ’å­—å¯¬è™•ç†ï¼‰
  - `curses`ï¼ˆå…§å»ºæ–¼ Pythonï¼Œè™•ç† CLI ä»‹é¢ï¼‰

---

## å®‰è£æ–¹å¼

### 1. Clone

```bash
git clone https://github.com/your-user/mesh-chat-cli.git
cd mesh-chat-cli
````

### 2. å®‰è£ Python å¥—ä»¶

```bash
pip3 install --break-system-packages wcwidth
```

---

## å¿«é€Ÿå•Ÿå‹•

### 1. è¨­å®š IBSS + batman-advï¼ˆMesh æ¨¡å¼ï¼‰

```bash
sudo ./setup_ibss.sh
```

* å°‡ wlan0 è¨­ç‚º IBSS æ¨¡å¼ä¸¦åŠ å…¥æŒ‡å®š SSID
* å•Ÿç”¨ batman-adv æ¨¡çµ„
* æŒ‡æ´¾éš¨æ©Ÿ IP çµ¦ bat0
* æ¸…é™¤ wlan0 IP ä»¥é¿å…è·¯ç”±è¡çª

### 2. å•Ÿå‹•èŠå¤©ç¨‹å¼

```bash
./start_chat.sh --name å°æ˜
```

é¦–æ¬¡åŸ·è¡Œæœƒæç¤ºè¼¸å…¥ç¯€é»æš±ç¨±ï¼Œä¸¦å°‡èŠå¤©ä»‹é¢é¡¯ç¤ºæ–¼çµ‚ç«¯æ©Ÿã€‚

---

## åŠŸèƒ½ç‰¹è‰²

### åŸºæœ¬åŠŸèƒ½

* `ç¾¤çµ„èŠå¤©å®¤`ï¼ˆé è¨­é »é“ generalï¼‰
* `ç§äººå°è©±`ï¼ˆé¸æ“‡é„°å±…ç¯€é»é€²è¡Œå–®ç¨èŠå¤©ï¼‰
* `æŸ¥çœ‹èŠå¤©è¨˜éŒ„`ï¼ˆæœ¬æ©Ÿ log è¨˜éŒ„ï¼‰
* `æƒæ`ï¼ˆæƒæä¸¦é¡¯ç¤ºæ‰€æœ‰æ´»èºç¯€é»ï¼‰

### é¡å¤–ç‰¹æ€§

* è‡ªå‹•è§£æä¾†è‡ªä»–äººè¨Šæ¯ï¼Œä¸¦å³æ™‚æ›´æ–°ç•«é¢
* æ”¯æ´ä¸­è‹±æ–‡èˆ‡ emoji å°é½Š
* ä½¿ç”¨è€…å¯å‘½åé„°å±…ç¯€é»
* æ‰€æœ‰è¨Šæ¯çš†é€é UDP å»£æ’­æˆ–å–®æ’­å°åŒ…å¯¦ä½œ

---

## ä½¿ç”¨ç•«é¢ï¼ˆæ–‡å­—ç¤ºæ„ï¼‰

```text
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘       Mesh CLI Chat          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ â–¶ ç¾¤çµ„èŠå¤©å®¤                  â•‘
â•‘   ç§äººå°è©±                    â•‘
â•‘   æŸ¥çœ‹èŠå¤©è¨˜éŒ„                 â•‘
â•‘   æƒæ                        â•‘
â•‘   é›¢é–‹                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â†‘â†“ï¼šé¸æ“‡åŠŸèƒ½   Enterï¼šåŸ·è¡Œ
```

åœ¨èŠå¤©å®¤ç•«é¢ä¸­ï¼Œåº•éƒ¨æœƒè‡ªå‹•é¡¯ç¤ºæœ€è¿‘æ”¶åˆ°çš„è¨Šæ¯ï¼š

```
> Hello everyone
[general] å°æ˜: Hello Pi B
[general] Pi B: Nice to meet you
```

---

## å°ˆæ¡ˆçµæ§‹

```
mesh-chat-cli/
â”œâ”€â”€ main.py                       # ä¸»ç¨‹å¼ï¼šå•Ÿå‹• curses UI èˆ‡æ¥æ”¶å™¨
â”œâ”€â”€ ping_sweep.sh                 # ä¾åº ping 10.0.0.0 åˆ° 10.0.0.255
â”œâ”€â”€ restore_wifi.sh               # é—œé–‰ Mesh ç¶²å¡ä¸¦é‚„åŸ
â”œâ”€â”€ setup_ibss.sh                 # è¨­å®š IBSS + batman-adv script
â”œâ”€â”€ start_chat.sh                 # ä¸€éµå•Ÿå‹• scriptï¼ˆå¯å¸¶ --nameï¼‰
â”œâ”€â”€ ui/
â”‚   â””â”€â”€ menu.py                   # curses UI ä¸»é¸å–® + ç¾¤çµ„è¨Šæ¯ / ç§äººè¨Šæ¯ä»‹é¢
â”œâ”€â”€ network/
â”‚   â””â”€â”€ messenger.py              # å»£æ’­ / å–®æ’­å°åŒ…å‚³é€èˆ‡æ¥æ”¶æ¨¡çµ„
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ config.py                 # æš±ç¨±è¼‰å…¥èˆ‡å„²å­˜ï¼ˆè®€å¯« node_config.jsonï¼‰
â”‚   â”œâ”€â”€ history.py                # è®€å–èˆ‡å¯«å…¥è¨Šæ¯ç´€éŒ„
â”‚   â””â”€â”€ neighbor_discovery.py     # å–å¾—é™„è¿‘ç¯€é» IP èˆ‡è‡ªå®šç¾©åç¨±
â”œâ”€â”€ config/
â”‚   â””â”€â”€ node_config.json          # å„²å­˜ç¯€é»æš±ç¨±çš„ JSON æª”ï¼ˆæœƒè‡ªå‹•ç”¢ç”Ÿï¼‰
â”œâ”€â”€ history/
â”‚   â””â”€â”€ general.log, ...
```

---

## ğŸ§ª æ¸¬è©¦èˆ‡é™¤éŒ¯

### æŸ¥çœ‹ bat0 IP

```bash
ip addr show dev bat0
```

### æ¸¬è©¦é€£ç·š

```bash
ping 10.0.0.X
```

### ç¢ºèª Mesh é„°å±…

```bash
sudo batctl n
sudo batctl dc
```

---

## æ³¨æ„äº‹é …

* è‹¥ä½¿ç”¨å…§å»º Wi-Fi æ¨¡çµ„ç„¡æ³•æˆåŠŸå»ºç«‹ Meshï¼Œå»ºè­°æ”¹ç”¨æ”¯æ´ IBSS çš„ USB ç¶²å¡ï¼ˆå¦‚ TP-Link TL-WN722N v1ã€Alfa AWUS036NHAï¼‰
* æ¯æ¬¡å•Ÿå‹•èŠå¤©å‰å¿…é ˆå…ˆåŸ·è¡Œ `setup_ibss.sh`
* è«‹å‹¿åŒæ™‚ä»¥å¤šå€‹çµ‚ç«¯é–‹å•Ÿ `main.py`ï¼Œé¿å… port è¡çª
